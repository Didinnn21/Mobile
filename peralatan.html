<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Peminjaman Peralatan - SIMARSIP</title>
  <link rel="stylesheet" href="https://cdn.framework7.io/framework7/5.7.10/css/framework7.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: #f4f7fb;
      font-family: -apple-system, sans-serif;
    }

    .page-content {
      padding: 16px;
      padding-bottom: 40px;
    }

    /* Form Styling */
    .form-row {
      margin-bottom: 18px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #333;
      text-transform: uppercase;
    }

    .required-mark {
      color: #dc2626;
      margin-left: 2px;
    }

    input[type=text],
    input[type=number],
    input[type=time],
    input[type=date],
    textarea,
    select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #dfeaf7;
      font-size: 14px;
      background: white;
      box-sizing: border-box;
      outline: none;
      transition: 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: #007aff;
      box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.1);
    }

    /* File Upload Styling */
    .file-upload-wrapper {
      border: 2px dashed #007aff;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      background: #f0f7ff;
      cursor: pointer;
      transition: 0.3s;
    }

    .file-upload-wrapper:hover {
      background: #e1efff;
    }

    .custom-file-input {
      display: none;
    }

    .file-upload-icon {
      font-size: 32px;
      color: #007aff;
      margin-bottom: 8px;
    }

    .file-upload-text {
      font-size: 13px;
      color: #007aff;
      font-weight: 600;
    }

    .file-name-preview {
      font-size: 12px;
      color: #4caf50;
      margin-top: 8px;
      font-weight: 700;
      display: none;
    }

    /* Info Boxes */
    .duration-info {
      background: #eef4ff;
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
      font-size: 13px;
      font-weight: 600;
      border-left: 4px solid #0052cc;
      color: #0052cc;
    }

    .error-message {
      color: #dc2626;
      font-size: 13px;
      margin-bottom: 15px;
      font-weight: 600;
      text-align: center;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    .button {
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      flex: 1;
      transition: 0.2s;
    }

    .button-fill {
      background: #007aff;
      color: #fff;
    }

    .button-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .button:active {
      transform: scale(0.98);
      opacity: 0.9;
    }
  </style>
</head>

<body>
  <header class="app-header" style="background: #007aff; padding: 16px; color: white;">
    <div class="app-header-inner" style="display: flex; align-items: center; gap: 12px;">
      <a href="index.html" style="color: white;"><i class="material-icons">arrow_back</i></a>
      <div style="font-weight: 800; font-size: 18px;">Form Peminjaman Peralatan</div>
    </div>
  </header>

  <main class="page-content">
    <div id="form-error" class="error-message"></div>

    <form id="booking-peralatan">
      <div class="form-row">
        <label class="form-label">Nama Kegiatan <span class="required-mark">*</span></label>
        <input type="text" name="title" placeholder="Contoh: Dokumentasi Wisuda" required>
      </div>

      <div class="form-row">
        <label class="form-label">Nama Peralatan <span class="required-mark">*</span></label>
        <input type="text" name="equipmentName" placeholder="Contoh: Kamera DSLR, Proyektor" required>
      </div>

      <div class="form-row">
        <label class="form-label">Jumlah (Unit) <span class="required-mark">*</span></label>
        <input type="number" name="quantity" min="1" placeholder="Masukkan jumlah unit" required>
      </div>

      <div class="form-row">
        <label class="form-label">Durasi Peminjaman (Hari) <span class="required-mark">*</span></label>
        <select name="duration" id="duration-select" required>
          <option value="1">1 Hari</option>
          <option value="2">2 Hari</option>
          <option value="3">3 Hari</option>
          <option value="7">1 Minggu</option>
        </select>
      </div>

      <div class="form-row">
        <label class="form-label">Tanggal Mulai <span class="required-mark">*</span></label>
        <input type="date" name="date" id="borrowDate" required>
        <div id="durationInfo" class="duration-info"></div>
      </div>

      <div style="display: flex; gap: 10px;">
        <div class="form-row" style="flex: 1;">
          <label class="form-label">Jam Mulai <span class="required-mark">*</span></label>
          <input type="time" name="start" required>
        </div>
        <div class="form-row" style="flex: 1;">
          <label class="form-label">Jam Selesai <span class="required-mark">*</span></label>
          <input type="time" name="end" required>
        </div>
      </div>

      <div class="form-row">
        <label class="form-label">Unggah Surat Lampiran <span class="required-mark">*</span></label>
        <div class="file-upload-wrapper" onclick="document.getElementById('fileSurat').click()">
          <i class="material-icons file-upload-icon">cloud_upload</i>
          <div class="file-upload-text">Klik untuk Upload PDF/Gambar</div>
          <input type="file" id="fileSurat" accept=".pdf,image/*" class="custom-file-input">
          <div id="file-name-display" class="file-name-preview"></div>
        </div>
      </div>

      <div class="form-row">
        <label class="form-label">Catatan (Opsional)</label>
        <textarea name="note" placeholder="Kebutuhan tambahan seperti baterai cadangan, kabel HDMI, dll..."></textarea>
      </div>

      <div class="actions">
        <button type="button" onclick="window.location.href='index.html'" class="button button-secondary">Batal</button>
        <button type="submit" class="button button-fill">Kirim Pengajuan</button>
      </div>
    </form>
  </main>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBtyn-cjuhsnlEn-9Wao1tCcJfUQbf6GnY",
      authDomain: "simarsip-apk.firebaseapp.com",
      databaseURL: "https://simarsip-apk-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "simarsip-apk"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Logic Durasi Tanggal Otomatis
    const dateInput = document.getElementById('borrowDate');
    const durationSelect = document.getElementById('duration-select');
    const durationInfo = document.getElementById('durationInfo');

    function updateDateInfo() {
      if (!dateInput.value) return;
      const start = new Date(dateInput.value);
      const days = parseInt(durationSelect.value);
      const end = new Date(start);
      end.setDate(start.getDate() + days - 1);

      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      durationInfo.innerHTML = `ðŸ“… <strong>Periode:</strong> ${start.toLocaleDateString('id-ID', options)} s/d ${end.toLocaleDateString('id-ID', options)}`;
    }

    dateInput.addEventListener('change', updateDateInfo);
    durationSelect.addEventListener('change', updateDateInfo);

    // Preview Nama File
    const fileInput = document.getElementById('fileSurat');
    const fileNameDisplay = document.getElementById('file-name-display');
    fileInput.addEventListener('change', function () {
      if (this.files[0]) {
        fileNameDisplay.innerText = "ðŸ“„ File: " + this.files[0].name;
        fileNameDisplay.style.display = "block";
      }
    });

    // Submit ke Firebase
    document.getElementById('booking-peralatan').addEventListener('submit', function (e) {
      e.preventDefault();
      const errorDiv = document.getElementById('form-error');

      if (!fileInput.files[0]) {
        errorDiv.innerText = "Harap unggah surat lampiran!";
        return;
      }

      const payload = {
        type: 'peralatan',
        organization: 'HMIF',
        title: this.title.value,
        equipmentName: this.equipmentName.value,
        quantity: this.quantity.value,
        duration: this.duration.value, // Data durasi ikut disimpan
        start: this.start.value,
        end: this.end.value,
        date: this.date.value,
        note: this.note.value,
        status: 'pending',
        createdAt: new Date().toISOString(),
        fileUrl: "https://placeholder.com/file-peralatan.pdf"
      };

      db.ref('pengajuan/peralatan').push(payload)
        .then(() => {
          alert("âœ… Pengajuan peminjaman peralatan berhasil dikirim!");
          window.location.href = 'index.html';
        })
        .catch(err => {
          errorDiv.innerText = "Gagal mengirim: " + err.message;
        });
    });
  </script>
</body>

</html>